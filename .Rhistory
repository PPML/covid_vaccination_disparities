facet_wrap(~RECIP_RACE_ETH) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent)
print(plot)
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties.pdf", width = 10, height = 6)
for (a in c("12-17", "18-49", "50-64", "65+")) {
plot <- ggplot(data = df[RECIP_AGE_GROUP==a &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian")],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
facet_wrap(~RECIP_RACE_ETH) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
}
dev.off()
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties.pdf", width = 12, height = 6)
for (a in c("12-17", "18-49", "50-64", "65+")) {
plot <- ggplot(data = df[RECIP_AGE_GROUP==a &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian")],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
facet_wrap(~RECIP_RACE_ETH) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
}
dev.off()
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties.pdf", width = 12, height = 6)
for (a in c("12-17", "18-49", "50-64", "65+")) {
plot <- ggplot(data = df[RECIP_AGE_GROUP==a &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
facet_wrap(~RECIP_RACE_ETH) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
}
dev.off()
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties.pdf", width = 12, height = 6)
for (a in c("12-17", "18-49", "50-64", "65+")) {
plot <- ggplot(data = df[RECIP_AGE_GROUP==a &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
facet_wrap(~RECIP_RACE_ETH) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
}
dev.off()
plot <- ggplot(data = df[RECIP_AGE_GROUP==a &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point(alpha = 0.8) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point(alpha = 0.8) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
# facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0("Age Group: ", a)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties_v2.pdf", width = 12, height = 6)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point(alpha = 0.8) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race" +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
}
dev.off()
tot <- fread("~/Downloads/CDPH_CDPHv02_recode_county_race_age_missed2nd.csv")
tot <- tot[RECIP_RACE_ETH=="Black or African American", RECIP_RACE_ETH:="Black"]
tot <- tot[RECIP_RACE_ETH%in%c("Asian", "Black", "Latino", "White")]
tot <- tot[, tot_late:=sum(n_late), by = c("RECIP_COUNTY_LABEL")]
tot <- tot[, tot_vax:=sum(n_vax), by = c("RECIP_COUNTY_LABEL")]
tot <- unique(tot[,.(RECIP_COUNTY_LABEL, tot_late, tot_vax)])
tot <- tot[, pct_late:=tot_late/tot_vax]
county_order <- unique(tot$RECIP_COUNTY_LABEL[order(tot$pct_late)])
df <- df[, tot_late:=sum(n_late), by = c("RECIP_COUNTY_LABEL")]
df <- df[, tot_vax:=sum(n_vax), by = c("RECIP_COUNTY_LABEL")]
county <- unique(df[,.(RECIP_COUNTY_LABEL, tot_late, tot_vax)])
setnames(county, "RECIP_COUNTY_LABEL", "County")
access <- fread("~/COVID/vaccination_analysis/hesitancy_analysis/poststrat_definitely_yes.csv")
access <- access[state_name=="California"]
access <- access[, County:=gsub(" County", "", county)]
county <- merge(county, access[,.(County, fb_pred, tot_pop)], by = "County")
county <- county[, pct:=tot_late/tot_pop]
county <- county[, pct_vax:=tot_late/tot_vax]
long <- melt(county, id.vars = c("County", "tot_late", "tot_vax", "tot_pop"))
long <- long[variable=="fb_pred", variable:="Unvaccinated but 'Definitely Yes'"]
long <- long[variable=="pct", variable:="Late on 2nd Dose"]
pdf("~/Downloads/missed2nd_county.pdf", width = 8, height = 6)
ggplot(data = long[!is.na(tot_pop) & variable!="pct_vax"], aes(x = reorder(County, value), y = value, fill = variable)) +
geom_bar(stat = "identity") +
theme_bw() +
labs(x = "", y = "Percent of Eligible Population", fill = "") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom") +
scale_fill_manual(values = c("#D56D27", "#3D6879"))
# geom_hline(yintercept = .06, linetype = "dashed") +
# annotate("text", x = "Plumas", y = 0.074, label = "California Average: 6%", size = 3.5)
ggplot(data = county[!is.na(tot_pop)], aes(x = reorder(County, pct), y = pct)) +
geom_bar(stat = "identity", fill = "#3D6879") +
theme_bw() +
labs(x = "", y = "Percent of Eligible Pop. 2+ Wks. Late on 2nd Dose") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
scale_y_continuous(labels = scales::percent) +
geom_hline(yintercept = .06, linetype = "dashed") +
annotate("text", x = "Plumas", y = 0.074, label = "California Average: 6%", size = 3.5)
ggplot(data = county[!is.na(tot_pop)], aes(x = reorder(County, pct_vax), y = pct_vax)) +
geom_bar(stat = "identity", fill = "#3D6879") +
theme_bw() +
labs(x = "", y = "Percent of Vaccinated Pop. 2+ Wks. Late on 2nd Dose") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
scale_y_continuous(labels = scales::percent) +
geom_hline(yintercept = .082, linetype = "dashed") +
annotate("text", x = "Santa Clara", y = 0.094, label = "California Average: 8%", size = 3.5)
dev.off()
states <- fread("~/Downloads/COVID-19_Vaccinations_in_the_United_States_Jurisdiction (4).csv")
states <- states[,.(Location, Date, Administered_Dose1_Recip_12Plus, Series_Complete_12Plus)]
states <- states[, shift_complete:=shift(Administered_Dose1_Recip_12Plus, n = 35, type = "lead"), by = "Location"]
states <- states[, smooth_complete:=frollmean((shift_complete-Series_Complete_12Plus), 7, align = "right"), by = c("Location")]
states <- states[Date=="07/17/2021"]
states <- states[,.(Location, Series_Complete_12Plus, shift_complete)]
access <- fread("~/COVID/vaccination_analysis/hesitancy_analysis/poststrat_definitely_yes.csv")
access <- access[, tot_pop_state:=sum(tot_pop), by = "state_name"]
access <- unique(access[, .(state_name, tot_pop_state)])
regions <- fread("https://raw.githubusercontent.com/cphalpert/census-regions/master/us%20census%20bureau%20regions%20and%20divisions.csv")
setnames(regions, c("State", "State Code"), c("state_name", "Location"))
states <- merge(states, regions, by = "Location")
states <- merge(states, access, by = "state_name")
states <- states[, pct_elig:=(shift_complete-Series_Complete_12Plus)/tot_pop_state]
states <- states[, pct_vax:=(shift_complete-Series_Complete_12Plus)/shift_complete]
pdf("~/Downloads/missed_second_doses.pdf", width = 8, height = 6)
ggplot(data = states[pct_vax>0], aes(x = reorder(state_name, pct_vax), y = pct_vax)) +
geom_bar(stat = "identity", fill = "#3D6879") +
geom_bar(data = states[state_name == "California"], stat = "identity", fill = "#D56D27") +
theme_bw() +
labs(x = "", y = "Percent of Vaccinated Pop. 2+ Wks. Late on 2nd Dose",
caption = "Includes all California Counties") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
scale_y_continuous(labels = scales::percent)
states <- states[state_name=="California", pct_vax:=0.082]
ggplot(data = states[pct_vax>0], aes(x = reorder(state_name, pct_vax), y = pct_vax)) +
geom_bar(stat = "identity", fill = "#3D6879") +
geom_bar(data = states[state_name == "California"], stat = "identity", fill = "#D56D27") +
theme_bw() +
labs(x = "", y = "Percent of Vaccinated Pop. 2+ Wks. Late on 2nd Dose",
caption = "Excludes San Diego County") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
scale_y_continuous(labels = scales::percent)
dev.off()
df <- fread("~/Downloads/CDPH_CDPHv02_recode_zip_race_age_missed2nd.csv")
df <- df[, tot_late:=sum(n_late), by = c("RECIP_ADDRESS_ZIP")]
county <- unique(df[,.(RECIP_ADDRESS_ZIP, tot_late)])
library(tidycensus)
vars <- load_variables(2019, "acs1", cache=T)
pops <- get_acs(geography = "zcta", variables = "B01001_001", year = 2019)
pops <- as.data.table(pops)
pops <- pops[GEOID %like% "^06"]
pops <- pops[, c("temp", "RECIP_ADDRESS_ZIP"):=tstrsplit(NAME, " ")]
pops <- pops[, tot_pop:=sum(estimate, na.rm=T), by = "RECIP_ADDRESS_ZIP"]
pops <- unique(pops[,.(RECIP_ADDRESS_ZIP, tot_pop)])
county <- merge(county, pops, by = "RECIP_ADDRESS_ZIP")
county <- county[, pct:=tot_late/tot_pop]
pdf("~/Downloads/missed2nd_zip.pdf", width = 8, height = 6)
ggplot(data = county[tot_pop>500 & pct<.4], aes(x = pct)) + geom_histogram() +
theme_bw() + labs(x = "Percent 2+ Wks Late on 2nd Dose", y = "Count of Zip Codes")
dev.off()
library(zipcodeR)
zip_data <- as.data.table(search_state('CA'))
county <- merge(county, zip_data, by.x="RECIP_ADDRESS_ZIP", by.y="zipcode")
county[pct>.2 & tot_pop>100][order(tot_late)]
df <- fread("~/Downloads/CDPH_CDPHv02_recode_county_race_age_missed2nd.csv")
df <- df[, pct_late:=n_late/n_vax]
df <- df[, se:=sqrt((pct_late*(1-pct_late))/n_vax)]
df <- df[, lower:=pct_late-se*1.96]
df <- df[, upper:=pct_late+se*1.96]
df <- df[lower<0, lower:=0]
df <- df[upper>1, upper:=1]
df <- df[RECIP_RACE_ETH=="Black or African American", RECIP_RACE_ETH:="Black"]
df <- df[RECIP_RACE_ETH=="American Indian or Alaska Native", RECIP_RACE_ETH:="AIAN"]
df <- df[RECIP_RACE_ETH=="Native Hawaiian or Other Pacific Islander", RECIP_RACE_ETH:="NHOPI"]
df <- df[, county_label:=factor(df$RECIP_COUNTY_LABEL, levels = county_order)]
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties_v2.pdf", width = 12, height = 6)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point(alpha = 0.8) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race" +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
dev.off()
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties_v2.pdf", width = 12, height = 6)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point(alpha = 0.8) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race") +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
dev.off()
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_point(alpha = 0.8, position = "jitter") +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race") +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties_v2.pdf", width = 12, height = 6)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
geom_point(alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race") +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
dev.off()
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties_v2.pdf", width = 12, height = 6)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.8) +
geom_point(alpha = 0.4) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race") +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
dev.off()
pdf("~/Downloads/CDPH_missed_2nd_correlates_4race_allcounties_v2.pdf", width = 12, height = 6)
plot <- ggplot(data = df[RECIP_AGE_GROUP!="Unknown Agegroup" &
RECIP_RACE_ETH%in%c("Black", "White", "Latino", "Asian") & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = RECIP_RACE_ETH)) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2, alpha = 0.4) +
geom_point(alpha = 0.8) +
facet_wrap(~RECIP_AGE_GROUP) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1, size = 8)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = "Missed 2nd Dose by County, Age, and Race") +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
print(plot)
dev.off()
df <- fread("~/Downloads/CDPH_CDPHv02_recode_county_race_age_missed2nd.csv")
head(df)
df <- fread("~/Downloads/CDPH_CDPHv02_recode_county_hpi_race_age_missed2nd.csv")
df <- fread("~/Downloads/CDPHv02_recode_county_hpi_race_age_missed2nd.csv")
head(df)
df <- df[, tot_late:=sum(n_late, na.rm=T), by = c("RECIP_COUNTY_LABEL", "HPIQUARTILE")]
df <- df[, tot_vax:=sum(n_vax, na.rm=T), by = c("RECIP_COUNTY_LABEL", "HPIQUARTILE")]
head(df)
df <- unique(df[,.(RECIP_COUNTY_LABEL, HPIQUARTILE, tot_late, tot_vax)])
head(df)
df <- df[, pct_late:=tot_late/tot_vax]
head(df)
df <- df[, county_label:=factor(df$RECIP_COUNTY_LABEL, levels = county_order)]
df <- df[, se:=sqrt((pct_late*(1-pct_late))/tot_vax)]
df <- df[, lower:=pct_late-se*1.96]
df <- df[, upper:=pct_late+se*1.96]
df <- df[lower<0, lower:=0]
df <- df[upper>1, upper:=1]
ggplot(data = df, aes(x = county_label, y = pct_late, color = HPIQUARTILE)) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2)
ggplot(data = df, aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2)
ggplot(data = df, aes(x = county_label[!is.na(HPIQUARTILE)], y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2)
ggplot(data = df[!is.na(HPIQUARTILE)], aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2)
ggplot(data = df[!is.na(HPIQUARTILE)], aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "Race/Ethnicity",
title = paste0(i)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent)
ggplot(data = df[!is.na(HPIQUARTILE)], aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "HPI Quartile",
title = paste0(i)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent)
ggplot(data = df[!is.na(HPIQUARTILE) & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "HPI Quartile",
title = paste0(i)) +
coord_cartesian(ylim = c(0, .6)) +
scale_y_continuous(labels = scales::percent)
ggplot(data = df[!is.na(HPIQUARTILE) & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "HPI Quartile",
title = paste0(i)) +
coord_cartesian(ylim = c(0, .4)) +
scale_y_continuous(labels = scales::percent)
pdf("~/Downloads/CDPH_missed_2nd_correlates_HPI.pdf", width = 10, height = 6)
ggplot(data = df[!is.na(HPIQUARTILE) & county_label!="Unknown" & county_label!="Outside California"],
aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "HPI Quartile",
title = "Missed 2nd Dose by County and HPI Quartile") +
coord_cartesian(ylim = c(0, .4)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
dev.off()
ggplot(data = df[!is.na(HPIQUARTILE) & county_label!="Unknown" & county_label!="Outside California" & tot_vax>=100],
aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "HPI Quartile",
title = "Missed 2nd Dose by County and HPI Quartile") +
coord_cartesian(ylim = c(0, .4)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
pdf("~/Downloads/CDPH_missed_2nd_correlates_HPI.pdf", width = 10, height = 6)
ggplot(data = df[!is.na(HPIQUARTILE) & county_label!="Unknown" & county_label!="Outside California" & tot_vax>=100],
aes(x = county_label, y = pct_late, color = as.factor(HPIQUARTILE))) +
geom_point() +
geom_errorbar(aes(ymin = lower, ymax = upper), width = .2) +
theme_bw() +
theme(axis.text.x = element_text(angle = 70, hjust=1)) +
labs(x = "", y = "% of Vaccinated Population that Missed 2nd Dose", color = "HPI Quartile",
title = "Missed 2nd Dose by County and HPI Quartile") +
coord_cartesian(ylim = c(0, .4)) +
scale_y_continuous(labels = scales::percent) +
theme(legend.position = "bottom")
dev.off()
df <- fread("~/COVID/vaccination_analysis/tract_pop_data_race.csv")
labels <- fread("~/COVID/vaccination_analysis/census_tract_full_age_labels.csv")
head(labels)
df <- merge(df, labels[,.(`Age Start`, `Age End`, race_grp_full, variable)], by = "variable")
df <- df[,.(GEOID, NAME, estimate, race_grp_full, `Age Start`, `Age End`)]
df <- df[, estimate:=sum(estimate, na.rm=T), by = c("GEOID", "NAME", "race_grp_full", "Age Start", "Age End")]
df <- unique(df)
# Compute Non-Hispanic White and Hispanic White
nhw <- df[race_grp_full%in%c("Non-Hispanic White", "White")]
nhw <- dcast(nhw, formula = GEOID + NAME + `Age Start` + `Age End` ~ race_grp_full, value.var = "estimate")
nhw <- nhw[, `Hispanic White`:= White - `Non-Hispanic White`]
re_data <- fread("~/COVID/vaccination_analysis/tract_pop_data_nothispanic.csv")
temp <- fread("~/COVID/vaccination_analysis/tract_pop_data_hispanic.csv")
re_data <- rbind(re_data, temp, fill = T)
# vars_out <- unique(re_data[,.(variable)])
# vars_out <- merge(vars_out, variables, by = "variable")
#write.csv(vars_out, "~/COVID/vaccination_analysis/census_tract_full_hisp_labels.csv", na = "", row.names = F)
labels <- fread("~/COVID/vaccination_analysis/census_tract_full_hisp_labels.csv")
labels <- labels[race_grp_full!=""]
labels <- labels[ethnicity!=""]
re_data <- merge(re_data, labels[,.(variable, race_grp_full, ethnicity)], by = "variable")
re_data <- re_data[race_grp_full!="White"]
re_data <- re_data[, variable:=NULL]
re_data <- re_data[, moe:=NULL]
re_data <- dcast(re_data, formula = GEOID + NAME + race_grp_full ~ ethnicity, value.var = "estimate")
re_data <- re_data[, pct_latino:=Latino/(`Not Latino`+Latino)]
re_data <- re_data[is.na(pct_latino), pct_latino:=0]
re_data <- re_data[, .(GEOID, NAME, race_grp_full, pct_latino)]
non_white <- df[race_grp_full!="White" & race_grp_full!="Non-Hispanic White" & race_grp_full!="Latino"]
non_white <- merge(non_white, re_data, by = c("race_grp_full", "GEOID", "NAME"))
non_white <- non_white[, latino:=estimate*pct_latino]
non_white <- non_white[, not_latino:=estimate*(1-pct_latino)]
non_white <- non_white[,.(race_grp_full, GEOID, NAME, `Age Start`, `Age End`, latino, not_latino)]
nhw <- nhw[, race_grp_full:="White"]
setnames(nhw, c("Hispanic White", "Non-Hispanic White"), c("latino", "not_latino"))
nhw <- nhw[,.(GEOID, NAME, `Age Start`, `Age End`, latino, not_latino, race_grp_full)]
final <- rbind(non_white, nhw)
write.csv(final, "~/COVID/vaccination_analysis/census_tract_full_race_ethnicity_youth.csv", na = "", row.names = F)
latino_agg <- copy(final)
latino_agg <- latino_agg[, race_grp_full:="Latino"]
latino_agg <- latino_agg[, estimate:=sum(latino, na.rm=T), by = c("NAME", "GEOID", "Age Start", "Age End")]
latino_agg <- unique(latino_agg[,.(race_grp_full, NAME, GEOID, `Age Start`, `Age End`, estimate)])
final <- final[,.(GEOID, race_grp_full, NAME, `Age Start`, `Age End`, not_latino)]
setnames(final, "not_latino", "estimate")
final <- rbind(final, latino_agg)
write.csv(final, "~/COVID/vaccination_analysis/census_tract_final_long_youth.csv", na = "", row.names = F)
